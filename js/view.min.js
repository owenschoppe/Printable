function fontHandler(a){changeFont(this.form,this.value)}function orientHandler(a){changeOrient(this.form,this.value)}function mHandler(a){changeTemplate(this.form,this.checked)}function printHandler(a){printDocumentPage();return false}function cancelHandler(a){window.close();return false}function templateHandler(a){openTemplate();return false}document.addEventListener("DOMContentLoaded",function(){document.querySelector("#typed").addEventListener("change",fontHandler);document.querySelector("#hand").addEventListener("change",fontHandler);document.querySelector("#landscape").addEventListener("change",orientHandler);document.querySelector("#portrait").addEventListener("change",orientHandler);document.querySelector("#mInput").addEventListener("change",mHandler);document.querySelector("#cancel-button").addEventListener("click",cancelHandler);document.querySelector("#template-button").addEventListener("click",templateHandler)});var bgPage=chrome.extension.getBackgroundPage();var SPREAD_SCOPE="https://spreadsheets.google.com/feeds";var DOCLIST_SCOPE="https://docs.google.com/feeds";var DOCLIST_FEED=DOCLIST_SCOPE+"/default/private/full/";var FULL_SCOPE=DOCLIST_SCOPE+" "+SPREAD_SCOPE;var docKey;var rows=[];var renderCallback=function(b,a,d){setTotal(a);var c=document.getElementById("output");c.replaceChild(b,c.firstChild);$("#loading").addClass("hidden");document.querySelector("#print-button").addEventListener("click",printHandler);document.querySelector("#print-button").disabled=false;console.timeEnd("renderNotes timer");makeDraggable();if(d){d()}};var renderNotes=function(a,b){console.log("renderNotes()");render(a,renderCallback,b)};setTotal=function(a){console.log("Set total: ",a);var b="<span class='Droid regular'>Total: </span><span class='Myriad bold'>"+a+" sheets of stickies</span>";document.getElementById("total").innerHTML=b};function printDocumentPage(a){console.log("open print dialog");window.print();console.log("done printing");if(a){a()}}function openTemplate(){if(localStorage.orientation=="portrait"){console.log("Open portrait template, ",localStorage.orientation);chrome.tabs.create({url:"template-portrait.html"})}else{console.log("Open landscape template, ",localStorage.orientation);chrome.tabs.create({url:"template-landscape.html"})}}changeFont=function(b,a){console.log("changeFont() ",a);localStorage.font=a;if(a=="Droid"){console.log("toggle to Droid");$(".summary").toggleClass("handwritten Droid");$(".title").toggleClass("handwritten Droid");$(".author").toggleClass("handwritten Droid");$(".url").toggleClass("handwritten Droid");$(".tags").toggleClass("handwritten Droid");$(".fontIcon").toggleClass("handwritten Droid")}else{console.log("toggle to handwritten");$(".summary").toggleClass("Droid handwritten");$(".title").toggleClass("Droid handwritten");$(".author").toggleClass("Droid handwritten");$(".url").toggleClass("Droid handwritten");$(".tags").toggleClass("Droid handwritten");$(".fontIcon").toggleClass("Droid handwritten")}return};changeOrient=function(a,b){console.log("changeOrient() ",b);localStorage.orientation=b;if(b=="portrait"){console.log("toggle to portrait");$(".page").toggleClass("landscape portrait");$(".loading").toggleClass("landscape portrait");$(".landscapeIcon").hide();$(".portraitIcon").show();toggleCSS(1)}else{console.log("toggle to landscape");$(".page").toggleClass("portrait landscape");$(".loading").toggleClass("portrait landscape");$(".landscapeIcon").show();$(".portraitIcon").hide();toggleCSS(0)}};changeTemplate=function(a,b){console.log("changeTemplate() ",b);localStorage.m=b;if(b==true){$(".page").addClass("m");document.querySelector("#template-button").disabled=true}else{$(".page").removeClass("m");document.querySelector("#template-button").disabled=false}};initRadio=function(d,c,b,a,e){console.log("initRadio() ",d);if(d){if(d==c){console.log("Default");document.forms[b].elements[a][0].checked=true;if(e){e(0)}}else{console.log("Not Default");document.forms[b].elements[a][1].checked=true;if(e){e(1)}}}else{console.log("Initialize");document.forms[b].elements[a][0].checked=true;if(e){e(0)}}};initCheck=function(d,c,b,a,e){console.log("initCheck() ",d);if(d){d=(d=="true");console.log(d,c,d==c);if(d==c){console.log("Default");document.forms[b].elements[a].checked=d;if(e){e(d)}}else{console.log("Not Default");document.forms[b].elements[a].checked=d;if(e){e(d)}}}else{console.log("Initialize");document.forms[b].elements[a].checked=c;if(e){e(c)}}};var toggleCSS=function(a,b){console.log("toggleCSS() ",a);switch(a){case 0:localStorage.orientation="landscape";document.styleSheets[0].disabled=false;document.styleSheets[1].disabled=true;$(".landscapeIcon").show();$(".portraitIcon").hide();break;case 1:localStorage.orientation="portrait";document.styleSheets[1].disabled=false;document.styleSheets[0].disabled=true;$(".landscapeIcon").hide();$(".portraitIcon").show();break}if(b){b(a)}};var noteOrderCSS=function(a){$(".note_wrapper").removeClass("left middle right");switch(a){case 0:$(".note_wrapper").addClass(function(b){return b%3==0?"left":(b%3==1?"middle":"right")});break;case 1:$(".note_wrapper").addClass(function(b){return b%2==0?"left":"right"});break}};var setFontIcon=function(a){if(a==0){localStorage.font="Droid"}else{localStorage.font="handwritten"}$(".fontIcon").addClass(localStorage.font)};var setTemplate=function(a){console.log("setTemplate() ",a);if(a==true){$(".page").addClass("m");document.querySelector("#template-button").disabled=true;console.log("addClass")}else{console.log("removeClass")}};changeAction=function(d,e,f){console.time("loading timer");$("#loading").removeClass("hidden");console.log(d,e);var b=localStorage[docKey].split(",");var c=parseInt(d.substr(5,1));b[c]=e;localStorage[docKey]=b;setTimeout(function(){renderNotes(f,a)},0);var a=function(){console.timeEnd("loading timer")}};function parseURLParams(a){var h=a.indexOf("?")+1;var b=a.indexOf("#")+1||a.length+1;var g=a.slice(h,b-1);if(g===a||g===""){return}var d={};var k=g.replace(/\+/g," ").split("&");for(var e=0;e<k.length;e++){var f=k[e].split("=");var c=decodeURIComponent(f[0]);var j=decodeURIComponent(f[1]);if(!(c in d)){d[c]=[]}d[c].push(f.length===2?j:null)}return d}if(bgPage.oauth.hasToken()){window.onload=function(){startup()}}else{console.log("hasToken == false");bgPage.oauth.authorize(function(){console.log("authorize callback");startup()})}var startup=function(){console.log("window.url ",document.URL);document.getElementById("loading").addClassName(localStorage.orientation);var a=localStorage.defaultDoc;if(a!=undefined){docKey=a;console.log('localStorage["defaultDoc"] ',a);gdocs.printDocument(null,processRowsCallback);gdocs.start()}else{console.log("Get doc from menu");gdocs.start(getDocId)}initCheck(localStorage.m,false,"mForm","m");initRadio(localStorage.orientation,"landscape","orientation","pages",toggleCSS);initRadio(localStorage.font,"Droid","fonts","font",setFontIcon)};var getDocId=function(){console.log("getDocId()");if($("#destination").length){console.log("Document menu exists");docKey=$("#destination").val().split(":")[1];console.log("docKey: ",docKey);gdocs.printDocument(null,processRowsCallback)}else{console.log("No document menu.");$("#loading").html('Try printing directly from a spreadsheet in <a href="https://drive.google.com">Google Drive</a>.')}};var processRowsCallback=function(){rows=row;console.log("processRowsCallback()",rows);var c=new Array();for(key in rows[1]){if(rows[1].hasOwnProperty(key)){c.push(key)}}console.log("Cols: ",c);var b=["field0","field1","field2","field3","field4"];buildSelect(c,b);for(var a=0;a<5;a++){initSelect(a,c,b)}console.log(localStorage);toggleCSS((localStorage.orientation=="portrait"?1:0));console.time("renderNotes timer");renderNotes(rows)};buildSelect=function(g,f,h){console.log("buildSelect()");var d=[];for(col in g){d.push('<option value="',g[col],'">',g[col],"</option>")}var e=document;for(var c=0;c<5;c++){var b=(c==2||c==3)?"half":"full";var a="field"+c;$("#elements").append('<div class="option '+a+'"><select id="'+a+'" class="Droid select '+b+'" name="'+a+'" ><option value="none">None</option>'+d.join("")+"</select></div>");a="#"+a;e.querySelector(a).addEventListener("change",onChangeHandler)}if(h){h()}};function onChangeHandler(a){changeAction(this.name,this.value,rows)}initSelect=function(e,g,f){var b=["summary","title","author","url","tags"];var d=f[e];console.log("initSelect",d,e,localStorage[docKey]);if(!localStorage[docKey]){localStorage[docKey]=""}var c=localStorage[docKey].split(",");if(c[e]){console.log("Existing value:",c[e]);$("select[name='"+d+"']").val(c[e])}else{console.log("No value ",localStorage[docKey]);var a=defaultLayout(g,b[e],b);c[e]=a;localStorage[docKey]=c;$("select[name='"+d+"']").val(a)}};var nextCol=0;defaultLayout=function(d,b,a){console.log("defaultLayout()",b,jQuery.inArray(b,d));var c=function(){console.log("Default column not found. Searching for next unique column.",d.length);for(var e=nextCol;e<d.length;e++){if(jQuery.inArray(d[e],a)==-1){nextCol=e+1;return d[e]}}return"none"};return jQuery.inArray(b,d)>-1?b:c()};$(window).scroll(function(){$("#indicator").css("top",function(){var d=Math.ceil($(window).scrollTop()/$("#output").height()*($(window).height()-0));return d});var a=$(".page");var c={page:0,percent:0};for(var b=0;b<a.length;b++){percent=percentScrolledIntoView(a[b]);if(percent>c.percent){c.page=b+1;c.percent=percent}}$("#pageNum").empty().append(c.page)});function percentScrolledIntoView(e){var g=$(window).scrollTop();var f=g+$(window).height();var b=$(e).offset().top;var a=$(e).height();var c=b+a;var d=((((c<=f)?c:f)-((b>=g)?b:g))/a);return d};
var dragSrcEl=null;Element.prototype.hasClassName=function(a){return new RegExp("(?:^|\\s+)"+a+"(?:\\s+|$)").test(this.className)};Element.prototype.addClassName=function(a){if(!this.hasClassName(a)){this.className=this.className?[this.className,a].join(" "):a}};Element.prototype.removeClassName=function(a){if(this.hasClassName(a)){var b=this.className;this.className=b.replace(new RegExp("(?:^|\\s+)"+a+"(?:\\s+|$)","g"),"")}};var makeDraggable=function(){console.log("makeDraggable()");console.time("draggable");var d=document.querySelectorAll("li.note_wrapper");var a=document.querySelector("#container");var c=true;var i;var h=document.createElement("li");h.className="placeholder note_wrapper ui-state-default left";h.setAttribute("draggable","false");function f(k){while(k.draggable!==true){k=k.parentElement;if(k.parentElement===null){break}}return k}function e(k){console.log("start",k);k.dataTransfer.effectAllowed="move";var l=f(k.target);k.dataTransfer.setDragImage(l.childNodes[0],145,145);dragSrc=this;dragSrcEl=this.cloneNode(true);c=true}this.handleDragOver=function(k){if(k.preventDefault){k.preventDefault()}};this.handleDragEnter=function(m){var l=$(this);if(c){var k=f(m.target);if(k==dragSrc){k.addClassName("moving");k.parentElement.insertBefore(h,k)}c=false}if(typeof i=="number"){window.clearTimeout(i)}i=window.setTimeout(function(){l[$(h).index()<l.index()?"after":"before"](h)},500)};this.handleDragLeave=function(k){};function j(k){console.log("drop",k);if(k.stopPropagation){k.stopPropagation()}if(dragSrcEl!=this){}return false}function g(k){console.log("end",k);[].forEach.call(d,function(l){l.removeClassName("over");l.removeClassName("moving")});h.parentElement.replaceChild(dragSrcEl,h);b(dragSrcEl);this.parentElement.removeChild(this);sortNotes()}[].forEach.call(d,function(k){b(k)});function b(k){k.setAttribute("draggable","true");k.addEventListener("dragstart",e,false);k.addEventListener("dragenter",handleDragEnter,false);k.addEventListener("dragend",g,false)}a.addEventListener("dragover",handleDragOver,false);h.addEventListener("drop",j,false);h.addEventListener("dragleave",handleDragLeave,false);console.timeEnd("draggable");sortNotes=function(k,r){console.log("sortNotes()");console.time("sortNotes");$("ul:empty").parent().remove();var t=$("ul");var m=0;var n=$("ul li:nth-child(7)");while(n.length>0){var q=n.eq(0);var s=q.parent().index("ul")+1;if(s==t.length){var p=document.createElement("div");p.id="page";p.className="page "+localStorage.orientation;var o=document.createElement("ul");o.id="content";o.className="sortable";p.appendChild(o);var l=document.getElementById("output");l.appendChild(p);t=t.add(o)}t.eq(s).prepend(q);m++;if(m>t.length){break}n=$("ul li:nth-child(7)")}setTotal(t.length);console.timeEnd("sortNotes")}};